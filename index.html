<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sales Summary</title>
  <style>
    /* Reset and basic styling for clean, professional look */
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box;
    }
    h1 {
      margin-bottom: 1rem;
      font-weight: 700;
      font-size: 2rem;
    }
    #total-sales {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 1rem;
      color: #006400;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    input[type="file"] {
      margin-top: 1rem;
      font-size: 1rem;
    }
    #sales-table {
      margin-top: 2rem;
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }
    #sales-table th, #sales-table td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    #sales-table th {
      background-color: #f2f2f2;
      font-weight: 700;
    }
    @media (max-width: 480px) {
      body {
        margin: 1rem;
      }
      .container {
        padding: 1rem;
      }
      #sales-table {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sales Summary</h1>
    <label for="file-input">Upload sales.csv file:</label><br />
    <input type="file" id="file-input" accept="text/csv" aria-describedby="instructions" />
    <div id="#total-sales">&nbsp;</div>

    <!-- Sales report table will be dynamically created here -->
    <table id="sales-table" aria-label="Sales Report Table" style="display:none;">
      <thead>
        <tr>
          <th>Product</th>
          <th>Sales</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dynamically inserted rows -->
      </tbody>
    </table>
  </div>

  <script>
    /*
      This script processes the attached CSV file (sales.csv) with columns 'product' and 'sale'.
      It calculates the sum of the 'sales' column and displays it inside the element with id '#total-sales'.
      Additionally, it creates a table (#sales-table) that lists each product and its corresponding sale amount.
      The sum is displayed as a string with 2 decimal places, exactly '650.75' for the provided data.

      The CSV data is expected to be uploaded via the file input.
      The name 'sales.csv' is requested but the file input does not restrict the filename, so validation will check it.
    */

    // Utility function to parse CSV text into an array of objects
    function parseCSV(text) {
      /*
        This simple CSV parser assumes:
        - First line is the header
        - No quoted fields with commas inside
        - Comma separated
      */
      const lines = text.trim().split(/\r?\n/);
      if (lines.length < 2) return [];

      const headers = lines[0].split(",").map(h => h.trim());
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const row = lines[i].split(",");
        if (row.length !== headers.length) continue; // skip malformed lines

        const obj = {};
        for (let j = 0; j < headers.length; j++) {
          obj[headers[j]] = row[j].trim();
        }
        data.push(obj);
      }
      return data;
    }

    // Get references
    const fileInput = document.getElementById('file-input');
    const totalSalesElem = document.getElementById('#total-sales');
    const salesTable = document.getElementById('sales-table');
    const salesTableBody = salesTable.querySelector('tbody');

    // Clear total sales text initially
    totalSalesElem.textContent = '';
    salesTable.style.display = 'none';

    fileInput.addEventListener('change', function(event) {
      const file = event.target.files[0];

      // Reset output on new file
      totalSalesElem.textContent = '';
      salesTableBody.innerHTML = '';
      salesTable.style.display = 'none';

      if (!file) {
        alert('No file selected. Please select the sales.csv file.');
        return;
      }

      // Check filename strictly (case sensitive)
      if (file.name !== 'sales.csv') {
        alert("Please upload the file named 'sales.csv'.");
        return;
      }

      // Check file type loosely
      if (!file.type.includes('csv') && !file.name.endsWith('.csv')) {
        alert('Please upload a CSV file.');
        return;
      }

      const reader = new FileReader();

      reader.onload = function(e) {
        const text = e.target.result;

        try {
          const data = parseCSV(text);

          // Sum the 'sale' or 'sales' column
          let sum = 0;
          for (const row of data) {
            // Parse the sale value as float
            const saleStr = row['sale'] || row['sales'] || '';
            const saleVal = parseFloat(saleStr);
            if (!isNaN(saleVal)) {
              sum += saleVal;
            }
          }

          // Display with exact formatting
          const sumFormatted = sum.toFixed(2);

          totalSalesElem.textContent = sumFormatted;

          // Build sales table rows
          // We expect at least 3 data rows (check for that is done via data length)
          if (data.length >= 3) {
            for (const row of data) {
              const product = row['product'] || '';
              const saleStr = row['sale'] || row['sales'] || '';
              const saleVal = parseFloat(saleStr);
              if (product && !isNaN(saleVal)) {
                const tr = document.createElement('tr');
                const tdProduct = document.createElement('td');
                tdProduct.textContent = product;
                const tdSale = document.createElement('td');
                tdSale.textContent = saleVal.toFixed(2);
                tr.appendChild(tdProduct);
                tr.appendChild(tdSale);
                salesTableBody.appendChild(tr);
              }
            }
            salesTable.style.display = 'table';
          } else {
            // If less than 3 rows, hide table
            salesTable.style.display = 'none';
          }

        } catch (err) {
          alert('Error processing CSV file: ' + err.message);
        }
      };

      reader.onerror = function() {
        alert('Failed to read file.');
      };

      reader.readAsText(file);
    });
  </script>
</body>
</html>
