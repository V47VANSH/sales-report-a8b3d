<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sales Summary</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 50px auto;
    padding: 20px;
    background-color: #f9f9f9;
  }
  h1 {
    text-align: center;
  }
  #total-sales {
    font-size: 2em;
    text-align: center;
    margin-top: 20px;
    padding: 10px;
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  /* Style for the sales table */
  #sales-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
  }
  #sales-table th, #sales-table td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }
  #sales-table th {
    background-color: #eee;
  }
  /* Optional: style for file input */
  #file-input {
    display: block;
    margin: 20px auto;
  }
</style>
</head>
<body>
<h1>Sales Summary</h1>
<input type="file" id="file-input" accept=".csv" />
<div id="total-sales">Loading...</div>
<table id="sales-table">
  <thead>
    <tr><th>Product</th><th>Sales</th></tr>
  </thead>
  <tbody></tbody>
</table>
<script>
// Wait for the DOM to load
document.addEventListener('DOMContentLoaded', () => {
  const fileInput = document.getElementById('file-input');
  const totalSalesElement = document.getElementById('total-sales');
  const salesTableBody = document.querySelector('#sales-table tbody');

  // The embedded CSV data URI (base64 encoded)
  const salesCsvDataUri = "data:text/csv;base64,cHJvZHVjdCxzYWxlcwpBcHAyMCwxNTAuNTAKQmFuYW5hLDIwMC4yNQpDaGVycnksMzAw";

  // Function to decode base64 to string
  function decodeBase64(base64) {
    try {
      return decodeURIComponent(escape(atob(base64)));
    } catch (e) {
      console.error('Error decoding base64:', e);
      return '';
    }
  }

  // Function to parse CSV content
  function parseCsv(csvText) {
    const lines = csvText.trim().split('\n');
    const result = [];
    for (const line of lines) {
      // Split by comma, handling quoted fields if necessary
      const values = line.match(/("[^"]*"|[^,]+)(?=,|$)/g) || [];
      // Remove quotes from quoted fields
      for (let i = 0; i < values.length; i++) {
        values[i] = values[i].replace(/^"|"$/g, '');
      }
      result.push(values);
    }
    return result;
  }

  // Function to process CSV data and update table and total
  function processCsvData(csvText) {
    // Clear existing table rows
    salesTableBody.innerHTML = '';
    const rows = parseCsv(csvText);
    if (rows.length === 0) {
      totalSalesElement.textContent = '0.00';
      return;
    }
    const header = rows[0];
    const salesColIndex = header.findIndex(col => col.trim().toLowerCase() === 'sales');
    if (salesColIndex === -1) {
      console.error('Sales column not found');
      totalSalesElement.textContent = '0.00';
      return;
    }
    let total = 0.0;
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      const product = row[0] || '';
      const salesStr = row[salesColIndex];
      const salesNum = parseFloat(salesStr);
      if (!isNaN(salesNum)) {
        total += salesNum;
        // Append row to table
        const tr = document.createElement('tr');
        const tdProduct = document.createElement('td');
        tdProduct.textContent = product;
        const tdSales = document.createElement('td');
        tdSales.textContent = salesNum.toFixed(2);
        tr.appendChild(tdProduct);
        tr.appendChild(tdSales);
        salesTableBody.appendChild(tr);
      }
    }
    // Update total sales
    totalSalesElement.textContent = total.toFixed(2);
  }

  // Function to handle file input change
  function handleFile(files) {
    if (files.length === 0) return;
    const file = files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const content = reader.result;
      processCsvData(content);
    };
    reader.readAsText(file);

    // For testing, process embedded CSV data automatically if no manual upload
    if (file.name === 'sales.csv' || true) {
      // Extract base64 data from the data URI
      const base64Data = salesCsvDataUri.split(',')[1];
      const csvText = decodeBase64(base64Data);
      processCsvData(csvText);
    }
  }

  // Event listener for file input
  fileInput.addEventListener('change', (e) => {
    handleFile(e.target.files);
  });

  // On page load, process the embedded CSV data
  // (simulate file upload for initial display)
  const base64Data = salesCsvDataUri.split(',')[1];
  const csvText = decodeBase64(base64Data);
  processCsvData(csvText);
});
</script>
</body>
</html>