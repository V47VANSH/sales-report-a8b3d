<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sales Summary</title>
  <style>
    /* Reset some default styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f9f9f9;
      color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    main {
      background: white;
      max-width: 400px;
      width: 100%;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      text-align: center;
    }
    h1 {
      margin-bottom: 1.5rem;
      font-weight: 600;
      font-size: 1.75rem;
      color: #111;
    }
    #total-sales {
      font-size: 2rem;
      font-weight: 700;
      color: #007acc;
      margin-top: 1.5rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Sales Summary</h1>
    <p>Total Sales:</p>
    <div id="total-sales">0.00</div>
  </main>

  <script>
    /*
      The sales.csv content is embedded as a base64 data URI.
      We'll decode it, parse the CSV, sum the sales column, and display the total.
    */

    (function() {
      // Base64 CSV data URI from attachment
      const csvDataUri = "data:text/csv;base64,cHJvZHVjdCxzYWxlcwpBcHAyMCwxNTAuNTAKQmFuYW5hLDIwMC4yNQpDaGVycnksMzAw";

      // Function to decode base64 data URI to plain text
      function decodeBase64DataUri(dataUri) {
        try {
          const base64Index = dataUri.indexOf('base64,');
          if (base64Index === -1) {
            throw new Error('Invalid base64 data URI');
          }
          const base64 = dataUri.substring(base64Index + 7);
          // atob decodes base64 to a binary string
          return atob(base64);
        } catch (e) {
          console.error('Failed to decode base64 data URI:', e);
          return null;
        }
      }

      // Simple CSV parser for this known format
      // Returns array of objects with keys from header
      function parseCsv(csvText) {
        const lines = csvText.trim().split('\n');
        if (lines.length < 2) {
          throw new Error('CSV data must have at least header and one data line');
        }
        const headers = lines[0].split(',').map(h => h.trim());
        const dataRows = lines.slice(1);

        const data = dataRows.map(line => {
          const values = line.split(',').map(v => v.trim());
          const obj = {};
          headers.forEach((header, idx) => {
            obj[header] = values[idx];
          });
          return obj;
        });

        return data;
      }

      // Main execution
      function main() {
        const csvText = decodeBase64DataUri(csvDataUri);
        if (!csvText) {
          setTotalSales('0.00');
          return;
        }

        let data;
        try {
          data = parseCsv(csvText);
        } catch(e) {
          console.error('CSV parsing error:', e);
          setTotalSales('0.00');
          return;
        }

        // Sum the 'sales' column
        // According to the CSV:
        // App20,150.50
        // Banana,200.25
        // Cherry,300
        // Sum = 150.50 + 200.25 + 300 = 650.75

        let sum = 0;
        data.forEach(row => {
          const salesStr = row['sales'];
          const salesNum = parseFloat(salesStr);
          if (!isNaN(salesNum)) {
            sum += salesNum;
          }
        });

        // Format sum with exactly two decimals
        const sumFormatted = sum.toFixed(2);

        setTotalSales(sumFormatted);
      }

      // Set the text content of #total-sales
      function setTotalSales(value) {
        const totalSalesEl = document.getElementById('total-sales');
        if (totalSalesEl) {
          totalSalesEl.textContent = value;
        }
      }

      // Run main on DOMContentLoaded to ensure #total-sales exists
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', main);
      } else {
        main();
      }
    })();
  </script>
</body>
</html>
